clear all
close all
clc

%gyro = [0.015504,0.00973162,0.0259292	,0.0194781	,0.0161138	,0.0159302	,0.0134982	,0.0149495	,0.0132986	,0.0028083	,0.0123831	,0.0174214	,0.0163813	,0.0128938	,0.0137282	,0.0148492	,0.0167344	,0.00904288,0.00539452,0.020893,0.0126621	,0.0130264	,0.0118088	,0.00755025,0.0107782	,0.00952238,0.0100154	,0.0118572	,0.00703209,0.0110829	,0.0170863	,0.0144059	,0.0149383	,0.0100648	,0.00966792,0.0118073	,0.00992175,0.00098098,0.0105756	,0.0127637	,0.0105109	,0.0112474	,0.0124387	,0.0122728	,0.00970857,0.00603664,0.00330728,0.00979007,0.0143008	,0.0131516	,0.00878256,0.00793813,0.00593313,0.00676591,0.00808844,0.00835523,0.00413394,0.0124247	,0.0135204	,0.0116104	,0.0120631	,0.0117835	,0.0118949	,0.0107387	,0.00995435,0.00132133,0.0122137	,0.0170391	,0.0141137	,0.00994937,0.0091271	,0.00808895,0.0100375	,0.0132701	,0.00301889,0.0140248	,0.0173677	,0.0151349	,0.0113544	,0.00580431,0.00645448,0.00726974,0.00793674,0.00593372,0.00533017,0.00816715,0.0108326	,0.0110514	,0.0120736	,0.00938263,0.00781662,0.00799176,0.00960159,0.00265102,0.00606067,0.0144281	,0.0130844	,0.0112173	,0.012411,0.00761171,0.0072551	,0.00805287,0.00830529,0.00109074,0.0113394	,0.0143429	,0.0105527	,0.00723455,0.00830427,0.0064192	,0.00839923,0.0108158	,0.00535139,0.00463749,0.00842567,0.0145918	,0.0134657	,0.0126354	,0.0121743	,0.0109153	,0.0107086	,0.00301461,0.0049874	,0.012716,0.0092081	,0.00841678,0.00975188,0.0100519	,0.012924,0.012718,0.00597124,0.0069834	,0.0138203	,0.0129245	,0.0170462	,0.0157744	,0.0109722	,0.00787502,0.00771323,0.00424669,0.013676,0.0171225	,0.0145136	,0.0124452	,0.00975304,0.00822735,0.00747825,0.00323594,0.0102475	,0.0112254	,0.0122421	,0.00945928,0.0105841	,0.0106013	,0.00809966,0.00060467,0.0149832	,0.0142536	,0.0136767	,0.00850028,0.00585526,0.00840486,0.0105457	,0.00728476,0.00623893,0.015728,0.0125477	,0.0206803	,0.0120547	,0.00969497,0.00655434,0.00655299,0.00270106,0.00747514,0.0148138	,0.0150365	,0.0102345	,0.00933118,0.00786017,0.0105659	,0.00859843,0.00712354,0.00203024,0.00774284,0.0113535	,0.013518,0.0141135	,0.0111559	,0.0108329	,0.00812829,0.00561205,0.00081322,0.00951343,0.0138431	,0.0122168	,0.0116089	,0.0113716	,0.00980267,0.00925661,0.0062733	,0.00257977,0.0102974	,0.013956,0.0125394	,0.0124986	,0.0123393	,0.0104134	,0.0107851	,0.0092603	,0.00759955,0.00394591,0.0160355	,0.0213219	,0.0195991	,0.0169419	,0.0107879	,0.00933544,0.00222148,0.00800404,0.0163098	,0.0162027];
%flow = [0.0134025,0.0103319,0.0266689,0.0186809,0.0178215,0.0140826,0.0144178,0.0120829,0.00770455,0.000245341,0.00658448,0.0146786,0.0149909,0.0131644,0.0141549,0.0141715,0.0156885,0.0156435,0.00227065,0.0227306,0.0189857,0.0114742,0.0143612,0.00856387,0.0114293,0.0114055,0.0123697,0.00758806,0.0103403,0.00397009,0.0165359,0.0152503,0.0141365,0.0123303,0.0118417,0.0139586,0.0129402,0.00163163,0.00554087,0.0135441,0.0121388,0.0134003,0.0119639,0.014302,0.0122886,0.00767388,0.00181559,0.00565369,0.0148497,0.013949,0.00889958,0.0108941,0.00983795,0.0084183,0.00913856,0.00924636,0.00352642,0.0125542,0.00840982,0.0127277,0.0159218,0.0133031,0.00815608,0.0114856,0.0105034,0.00180028,0.0111156,0.0094781,0.0136795,0.0106987,0.0102059,0.00492082,0.00618498,0.0126978,0.00609291,0.0131023,0.0193618,0.0146948,0.0141708,0.00668261,0.00465299,0.0109455,0.00646901,0.00544807,0.00656906,0.00996347,0.0125314,0.00734189,0.0132648,0.0108191,0.0105609,0.00495344,0.0112599,0.0052785,0.00612016,0.0134514,0.0135786,0.0115963,0.0145798,0.00946813,0.00482344,0.00605595,0.00495556,0.00186034,0.0126175,0.01403,0.0125156,0.00408455,0.00924367,0.00876833,0.0122628,0.00746558,0.0079868,0.00754869,0.00788708,0.0088931,0.0181827,0.0138984,0.01269,0.0122577,0.00454713,0.00295748,0.0027407,0.0133401,0.00880325,0.0104676,0.010504,0.0114868,0.0171387,0.0139501,0.00811318,0.00326324,0.0141883,0.0137292,0.0156947,0.00912115,0.00702606,0.00820126,0.00954736,0.00634462,0.00741145,0.0126832,0.0154806,0.0142965,0.0115191,0.0144975,0.00948122,0.00506723,0.0158287,0.0128917,0.0144374,0.00533972,0.0115509,0.00932896,0.00792457,0.00316723,0.00942436,0.0147669,0.0131628,0.00634216,0.00777935,0.00957685,0.0118635,0.00725777,0.00499462,0.0085238,0.0134717,0.0227831,0.0120865,0.0110712,0.0065407,0.00514246,0.00382334,0.00794981,0.0134476,0.00932845,0.00759491,0.0159861,0.00967398,0.0144644,0.0171312,0.00803561,0.00114678,0.00809,0.0122187,0.00708452,0.0154449,0.0109248,0.0102981,0.00802038,0.0074618,0.00201766,0.0095341,0.0150271,0.0120767,0.00743014,0.0130373,0.0114172,0.0100804,0.00890194,0.00473557,0.00990822,0.0134972,0.0143505,0.00833616,0.0122669,0.0111095,0.0117839,0.0100079,0.0106874,0.00270089,0.0135822,0.01714,0.0124762,0.0189158,0.0130381,0.00861439,0.000618902,0.00795783,0.0165391,0.0158084];

gyro = [0.015504,0.00973162,0.0259292,0.0194781,0.0161138,0.0159302,0.0134982,0.0149495,0.0132986,0.0123831,0.0174214,0.0163813,0.0128938,0.0137282,0.0148492,0.0167344,0.00904288,0.00539452,0.020893,0.0126621,0.0130264,0.0118088,0.00755025,0.0107782,0.00952238,0.0100154,0.0118572,0.00703209,0.0110829,0.0170863,0.0144059,0.0149383,0.0100648,0.00966792,0.0118073,0.00992175,0.00098098,0.0105756,0.0127637,0.0105109,0.0112474,0.0124387,0.0122728,0.00970857,0.00603664,0.00330728,0.00979007,0.0143008,0.0131516,0.00878256,0.00793813,0.00593313,0.00676591,0.00808844,0.00835523,0.00413394,0.0124247,0.0135204,0.0116104,0.0120631,0.0117835,0.0118949,0.0107387,0.00995435,0.00132133,0.0122137,0.0170391,0.0141137	,0.00994937,0.0091271	,0.00808895,0.0100375	,0.0132701	,0.00301889,0.0140248	,0.0173677	,0.0151349	,0.0113544	,0.00580431,0.00645448,0.00726974,0.00793674,0.00593372,0.00533017,0.00816715,0.0108326	,0.0110514	,0.0120736	,0.00938263,0.00781662,0.00799176,0.00960159,0.00265102,0.00606067,0.0144281	,0.0130844	,0.0112173	,0.012411,0.00761171,0.0072551	,0.00805287,0.00830529,0.00109074,0.0113394	,0.0143429	,0.0105527	,0.00723455,0.00830427,0.0064192	,0.00839923,0.0108158	,0.00535139,0.00463749,0.00842567,0.0145918	,0.0134657	,0.0126354	,0.0121743	,0.0109153	,0.0107086	,0.00301461,0.0049874	,0.012716,0.0092081	,0.00841678,0.00975188,0.0100519	,0.012924,0.012718,0.00597124,0.0069834	,0.0138203	,0.0129245	,0.0170462	,0.0157744	,0.0109722	,0.00787502,0.00771323,0.00424669,0.013676,0.0171225	,0.0145136	,0.0124452	,0.00975304,0.00822735,0.00747825,0.00323594,0.0102475	,0.0112254	,0.0122421	,0.00945928,0.0105841	,0.0106013	,0.00809966,0.00060467,0.0149832	,0.0142536	,0.0136767	,0.00850028,0.00585526,0.00840486,0.0105457	,0.00728476,0.00623893,0.015728,0.0125477	,0.0206803	,0.0120547	,0.00969497,0.00655434,0.00655299,0.00270106,0.00747514,0.0148138	,0.0150365	,0.0102345	,0.00933118,0.00786017,0.0105659	,0.00859843,0.00712354,0.00203024,0.00774284,0.0113535	,0.013518,0.0141135	,0.0111559	,0.0108329	,0.00812829,0.00561205,0.00081322,0.00951343,0.0138431	,0.0122168	,0.0116089	,0.0113716	,0.00980267,0.00925661,0.0062733	,0.00257977,0.0102974	,0.013956,0.0125394,0.0124986,0.0123393,0.0104134,0.0107851,0.0092603,0.00759955,0.00394591,0.0160355,0.0213219,0.0195991,0.0169419,0.0107879,0.00933544,0.00222148,0.00800404,0.0163098	,0.0162027];
flow = [0.0134025,0.0103319,0.0266689,0.0186809,0.0178215,0.0140826,0.0144178,0.0120829,0.00770455,0.00658448,0.0146786,0.0149909,0.0131644,0.0141549,0.0141715,0.0156885,0.0156435,0.00227065,0.0227306,0.0189857,0.0114742,0.0143612,0.00856387,0.0114293,0.0114055,0.0123697,0.00758806,0.0103403,0.00397009,0.0165359,0.0152503,0.0141365,0.0123303,0.0118417,0.0139586,0.0129402,0.00163163,0.00554087,0.0135441,0.0121388,0.0134003,0.0119639,0.014302,0.0122886,0.00767388,0.00181559,0.00565369,0.0148497,0.013949,0.00889958,0.0108941,0.00983795,0.0084183,0.00913856,0.00924636,0.00352642,0.0125542,0.00840982,0.0127277,0.0159218,0.0133031,0.00815608,0.0114856,0.0105034,0.00180028,0.0111156,0.0094781,0.0136795,0.0106987,0.0102059,0.00492082,0.00618498,0.0126978,0.00609291,0.0131023,0.0193618,0.0146948,0.0141708,0.00668261,0.00465299,0.0109455,0.00646901,0.00544807,0.00656906,0.00996347,0.0125314,0.00734189,0.0132648,0.0108191,0.0105609,0.00495344,0.0112599,0.0052785,0.00612016,0.0134514,0.0135786,0.0115963,0.0145798,0.00946813,0.00482344,0.00605595,0.00495556,0.00186034,0.0126175,0.01403,0.0125156,0.00408455,0.00924367,0.00876833,0.0122628,0.00746558,0.0079868,0.00754869,0.00788708,0.0088931,0.0181827,0.0138984,0.01269,0.0122577,0.00454713,0.00295748,0.0027407,0.0133401,0.00880325,0.0104676,0.010504,0.0114868,0.0171387,0.0139501,0.00811318,0.00326324,0.0141883,0.0137292,0.0156947,0.00912115,0.00702606,0.00820126,0.00954736,0.00634462,0.00741145,0.0126832,0.0154806,0.0142965,0.0115191,0.0144975,0.00948122,0.00506723,0.0158287,0.0128917,0.0144374,0.00533972,0.0115509,0.00932896,0.00792457,0.00316723,0.00942436,0.0147669,0.0131628,0.00634216,0.00777935,0.00957685,0.0118635,0.00725777,0.00499462,0.0085238,0.0134717,0.0227831,0.0120865,0.0110712,0.0065407,0.00514246,0.00382334,0.00794981,0.0134476,0.00932845,0.00759491,0.0159861,0.00967398,0.0144644,0.0171312,0.00803561,0.00114678,0.00809,0.0122187,0.00708452,0.0154449,0.0109248,0.0102981,0.00802038,0.0074618,0.00201766,0.0095341,0.0150271,0.0120767,0.00743014,0.0130373,0.0114172,0.0100804,0.00890194,0.00473557,0.00990822,0.0134972,0.0143505,0.00833616,0.0122669,0.0111095,0.0117839,0.0100079,0.0106874,0.00270089,0.0135822,0.01714,0.0124762,0.0189158,0.0130381,0.00861439,0.000618902,0.00795783,0.0165391,0.0158084];

%% Mean ration
% computing mean ratio and std dev.
factor = flow./gyro;
m = mean(factor);
sigma = std(factor);
s = std(factor)/sqrt(220);

% plot
x = gyro';
y = flow';
figure;
plot(x,y, '+');
hold on;
plot(x, x*m, '-', 'color', 'r');
xlabel('gyroscope measurements');
ylabel('optic-flow measurements');
legend('Training data', 'Mean ratio regression');
hold off;
printf('Mean ratio:\n')
printf('Slope: %d\n', m);
printf('Std. dev.: %d\n', sigma);
printf('Std. error: %d\n', s);

%% Least Squares
% using regular least square regression with bias
x = gyro';
y = flow';
m = length(x);
X = [ones(m,1), x];
w = (pinv(X'*X))*X'*y;
rss = sum((y - X*w).^2);

% plot
figure;
plot(x,y, '+');
hold on;
plot(X(:,2),X*w, '-', 'color', 'r');
xlabel('gyroscope measurements');
ylabel('optic-flow measurements');
legend('Training data', 'Linear regression');
hold off;
printf('Least Squares without bias:\n')
printf('Bias: %d\n', w(1));
printf('Slope: %d\n', w(2));
printf('RSS: %d\n', rss);

% using regular mean square regression with bias
x = gyro';
y = flow';
m = length(x);
w = (pinv(x'*x))*x'*y;
rss = sum((y - x*w).^2);

% plot
figure;
plot(x,y,'+');
hold on;
plot(x, x*w, '-', 'color', 'r');
xlabel('gyroscope measurements');
ylabel('optic-flow measurements');
legend('Training data', 'Linear regression');
hold off;
printf('Least Squares without bias:\n')
printf('Slope: %d\n', w(1));
printf('RSS: %d\n', rss);

%% RANSAC
%data = [gyro;flow];
%[w1, w0] = ransac(data, 2, 1000, 0.003, 0.85);
%
%% plot 
%figure;
%plot(x,y, '+');
%hold on;
%plot(x, ones(m,1)*w0 + x*w1, '-', 'color', 'r');
%xlabel('gyroscope measurements');
%ylabel('optic-flow measurements');
%legend('Training data', 'RANSAC');
%hold off;
%printf('RANSAC:\n');
%printf('Bias: %d \n', w0);
%printf('Slope: %d \n', w1);

plot(x);
hold on;
plot(y, 'color', 'r');